<!DOCTYPE html>
<html>  
    <head>
        <meta charset="UTF-8">
            
        <title>JaanChat</title>

        <link rel="stylesheet" type="text/css" href="style.css">   
    </head>  
    
    <body>    
        <!--- The messages go here-->
        <ul id="messages"></ul>   
        
        <!---message input nad submit button--> 
        <form id="message_form" action="">      
            <input id="message_input" autocomplete="off" /> 
            <button>Send</button>    
        </form>

        <!-- The Modal for nickname -->
        <div id="myModal" class="modal">
            <div class="modal-content"> 
                <div class="modal-body">
                    <form id="nick_form">
                        <input id="nick_input" autocomplete="off" autofocus="autofocus" onfocus="this.select()" placeholder="Please enter a nickname"/>
                        <button id="nick_button" class="close">Enter</button>
                    </form>
                </div>
            </div>
        </div>
    </body>

    <script src="/socket.io/socket.io.js"></script>

    <script>  
        var socket = io();


        // Modal Functions
        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
            message_input.focus();
        }

        // When the user clicks anywhere outside of the modal, close it and submit an anonymous name
        /*window.onclick = function(e) {
            if (e.target == modal) {
                modal.style.display = "none";
                nick_form.submit();
            }
            //e.preventDefault();
            //nick_form.submit(e);
        }*/

        //For nickname
        var nick;
        var nick_form = document.getElementById('nick_form');
        var nick_input = document.getElementById('nick_input');



        nick_form.onsubmit = function(e){
            e.preventDefault();
            if(!nick_input.value){
                nick = 'Anonymous';
            }
            socket.emit('nickname', nick_input.value);
            nick = nick_input.value;
        };


        /*function nick_submit(e){
            e.preventDefault();
            if(!nick_input.value){
                nick = 'Anonymous';
            }
            socket.emit('nickname', nick_input.value);
            nick = nick_input.value;
        }*/

        // For messages
        var message_form = document.getElementById('message_form');  
        var message_input = document.getElementById('message_input');

        message_form.onsubmit = function(e) {    
            e.preventDefault();
            if (message_input.value) {   
                socket.emit('chat message', message_input.value);  
                message_input.value = '';
            }
            return false;  
        };

        socket.on('chat message', function(msg) {    
            var item = document.createElement('li');    
            item.textContent = msg;    
            messages.appendChild(item);    
            window.scrollTo(0, document.body.scrollHeight);  
        });
    </script>  
</html>